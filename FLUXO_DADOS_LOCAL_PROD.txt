================================================================================
FLUXO DE DADOS: LOCAL vs PRODU√á√ÉO - SISTEMA CHURN
================================================================================

üìã RESUMO EXECUTIVO
-------------------
O sistema possui DOIS ambientes com diferentes fontes de dados:

1. LOCAL (Desenvolvimento): Arquivos salvos em pasta local do PC
2. PRODU√á√ÉO (Streamlit Cloud): Arquivos acessados via SharePoint Online


================================================================================
üîÑ FLUXO COMPLETO DE DADOS
================================================================================

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                          GERADOR (Local/Servidor)                        ‚îÇ
‚îÇ                       gerador_dados_churn.py                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                    ‚îÇ
                                    ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ  Conecta MongoDB                     ‚îÇ
              ‚îÇ  Extrai: gatherings, laboratories,   ‚îÇ
              ‚îÇ          representatives             ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                    ‚îÇ
                                    ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ  Salva LOCALMENTE em:                ‚îÇ
              ‚îÇ  ./output_churn/                     ‚îÇ
              ‚îÇ                                      ‚îÇ
              ‚îÇ  Arquivos gerados:                   ‚îÇ
              ‚îÇ  - gatherings_2024.csv               ‚îÇ
              ‚îÇ  - gatherings_2025.csv               ‚îÇ
              ‚îÇ  - laboratories.csv                  ‚îÇ
              ‚îÇ  - representatives.csv               ‚îÇ
              ‚îÇ  - churn_analysis_latest.parquet     ‚îÇ
              ‚îÇ  - churn_analysis_latest.csv         ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                    ‚îÇ
                                    ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ  TENTA Upload SharePoint             ‚îÇ
              ‚îÇ  (linhas 641-661)                    ‚îÇ
              ‚îÇ                                      ‚îÇ
              ‚îÇ  Se tiver secrets.toml:              ‚îÇ
              ‚îÇ  - L√™ configura√ß√µes Graph API        ‚îÇ
              ‚îÇ  - Usa ChurnSPConnector              ‚îÇ
              ‚îÇ  - Faz upload para OneDrive/SP       ‚îÇ
              ‚îÇ                                      ‚îÇ
              ‚îÇ  Se falhar: apenas loga aviso        ‚îÇ
              ‚îÇ  (n√£o interrompe o processo)         ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò


‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    APP STREAMLIT (Produ√ß√£o/Local)                        ‚îÇ
‚îÇ                       app_streamlit_churn.py                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                    ‚îÇ
                                    ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  Detecta ambiente:            ‚îÇ
                    ‚îÇ                               ‚îÇ
                    ‚îÇ  LOCAL: arquivo existe em     ‚îÇ
                    ‚îÇ         ./output_churn/       ‚îÇ
                    ‚îÇ                               ‚îÇ
                    ‚îÇ  PROD: arquivo N√ÉO existe     ‚îÇ
                    ‚îÇ        localmente             ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ               ‚îÇ
                            ‚îÇ               ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   LOCAL      ‚îÇ   ‚îÇ   PRODU√á√ÉO    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ                    ‚îÇ
                            ‚ñº                    ‚ñº
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ L√™ arquivo local:     ‚îÇ   ‚îÇ Usa ChurnSPConnector: ‚îÇ
            ‚îÇ pd.read_parquet()     ‚îÇ   ‚îÇ connector.read_csv()  ‚îÇ
            ‚îÇ                       ‚îÇ   ‚îÇ                       ‚îÇ
            ‚îÇ Caminho:              ‚îÇ   ‚îÇ Acessa SharePoint:    ‚îÇ
            ‚îÇ ./output_churn/       ‚îÇ   ‚îÇ - Autentica Graph API ‚îÇ
            ‚îÇ churn_analysis_       ‚îÇ   ‚îÇ - Baixa arquivo remoto‚îÇ
            ‚îÇ latest.parquet        ‚îÇ   ‚îÇ - Retorna DataFrame   ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò


================================================================================
üìÇ ESTRUTURA DE ARQUIVOS
================================================================================

LOCAL (PC/Servidor onde roda gerador):
--------------------------------------
F:\Progama√ß√£o\ChurnAi\
‚îú‚îÄ‚îÄ gerador_dados_churn.py          ‚Üê Gera dados
‚îú‚îÄ‚îÄ app_streamlit_churn.py          ‚Üê App Streamlit
‚îú‚îÄ‚îÄ churn_sp_connector.py           ‚Üê Conector SharePoint
‚îú‚îÄ‚îÄ config_churn.py                 ‚Üê Configura√ß√µes
‚îú‚îÄ‚îÄ .streamlit/
‚îÇ   ‚îî‚îÄ‚îÄ secrets.toml                ‚Üê Credenciais (N√ÉO commitar!)
‚îî‚îÄ‚îÄ output_churn/                   ‚Üê DADOS GERADOS LOCALMENTE
    ‚îú‚îÄ‚îÄ gatherings_2024.csv
    ‚îú‚îÄ‚îÄ gatherings_2025.csv
    ‚îú‚îÄ‚îÄ laboratories.csv
    ‚îú‚îÄ‚îÄ representatives.csv
    ‚îú‚îÄ‚îÄ churn_analysis_latest.parquet
    ‚îî‚îÄ‚îÄ churn_analysis_latest.csv


PRODU√á√ÉO (Streamlit Cloud):
---------------------------
Streamlit Cloud App
‚îú‚îÄ‚îÄ gerador_dados_churn.py          ‚Üê N√ÉO executa em produ√ß√£o
‚îú‚îÄ‚îÄ app_streamlit_churn.py          ‚Üê App principal
‚îú‚îÄ‚îÄ churn_sp_connector.py           ‚Üê Conector SharePoint
‚îú‚îÄ‚îÄ config_churn.py                 ‚Üê Configura√ß√µes
‚îú‚îÄ‚îÄ secrets (via Streamlit UI)      ‚Üê st.secrets (interface web)
‚îî‚îÄ‚îÄ output_churn/                   ‚Üê Pasta VAZIA ou inexistente
    ‚îî‚îÄ‚îÄ (sem arquivos)

                    ‚ñ≤
                    ‚îÇ
                    ‚îÇ Acessa via Graph API
                    ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ  SharePoint Online                                   ‚îÇ
            ‚îÇ  synviagroup-my.sharepoint.com                       ‚îÇ
            ‚îÇ                                                      ‚îÇ
            ‚îÇ  Path completo:                                      ‚îÇ
            ‚îÇ  /personal/washington_gouvea_synvia_com_/            ‚îÇ
            ‚îÇ    Documents/Data Analysis/Churn PCLs/               ‚îÇ
            ‚îÇ                                                      ‚îÇ
            ‚îÇ  Arquivos:                                           ‚îÇ
            ‚îÇ  ‚úì churn_analysis_latest.csv      (dados principais)‚îÇ
            ‚îÇ  ‚úì matriz_cs_normalizada.csv      (VIP/matriz CS)   ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò


================================================================================
üìÅ ARQUIVOS DO SISTEMA
================================================================================

O sistema utiliza DOIS arquivos principais no SharePoint:

1. churn_analysis_latest.csv
   -------------------------
   - Fonte: Gerado pelo gerador_dados_churn.py
   - Conte√∫do: An√°lise completa de churn de laborat√≥rios
   - Path: /personal/washington_gouvea_synvia_com_/Documents/Data Analysis/Churn PCLs/
   - Autentica√ß√£o: [graph] client_id/secret (680b6cbf...)
   - Acesso: ChurnSPConnector com st.secrets['graph']
   - Frequ√™ncia atualiza√ß√£o: A cada 15 minutos (gerador)

2. matriz_cs_normalizada.csv
   --------------------------
   - Fonte: Sistema VIP (vip_integration.py)
   - Conte√∫do: Matriz de Customer Success normalizada
   - Path: /personal/washington_gouvea_synvia_com_/Documents/Data Analysis/Churn PCLs/
   - Autentica√ß√£o: [auth] client_id/secret (7c19a480...)
   - Acesso: VIPHistoryManager com st.secrets['auth']
   - Frequ√™ncia atualiza√ß√£o: Manual ou via sistema VIP

‚ö†Ô∏è IMPORTANTE: 
   S√£o DUAS autentica√ß√µes diferentes (Graph API):
   - [graph] ‚Üí Para churn_analysis_latest.csv
   - [auth]  ‚Üí Para matriz_cs_normalizada.csv


================================================================================
üîë CONFIGURA√á√ïES NECESS√ÅRIAS
================================================================================

1. LOCAL (Desenvolvimento):
   -------------------------
   .streamlit/secrets.toml:
   ```toml
   # String de conex√£o do MongoDB
   mongodb_uri = "mongodb+srv://ctox-prod-read:a0gho3oqn93HHW6L@ctox0.u8vx3.gcp.mongodb.net/homolog"
   mongodb_database = "ctox"

   # Configura√ß√µes de email para alertas
   email_alerta = "seuemail@exemplo.com"
   smtp_server = "smtp.exemplo.com"
   smtp_port = 587
   smtp_user = "user"
   smtp_password = "pass"

   # Configura√ß√µes do Microsoft Graph API para SharePoint/OneDrive
   [graph]
   tenant_id = "fee1b506-24b6-444a-919e-83df9442dc5d"
   client_id = "680b6cbf-ded3-4839-bdba-cfa8d5051309"
   client_secret = "YOUR_GRAPH_CLIENT_SECRET_HERE"
   hostname = "synviagroup-my.sharepoint.com"
   site_path = "personal/washington_gouvea_synvia_com_"
   library_name = "Documents"

   [files]
   arquivo = "/personal/washington_gouvea_synvia_com_/Documents/Data Analysis/Churn PCLs/churn_analysis_latest.csv"
   arquivo_vip = "/personal/washington_gouvea_synvia_com_/Documents/Data Analysis/Churn PCLs/matriz_cs_normalizada.csv"

   [onedrive]
   user_upn = "washington.gouvea@synvia.com"

   # Configura√ß√µes de diret√≥rio de sa√≠da
   output_dir = "/tmp/churn_data"

   # Configura√ß√µes do Microsoft Authentication
   [auth]
   client_id = "7c19a480-bc01-45b6-8b74-6a3e6154e876"
   client_secret = "YOUR_AUTH_CLIENT_SECRET_HERE"
   tenant_id = "fee1b506-24b6-444a-919e-83df9442dc5d"
   redirect_uri_local = "http://localhost:8501"
   redirect_uri_prod = "https://syntoxchurn.streamlit.app/"
   authority = "https://login.microsoftonline.com/fee1b506-24b6-444a-919e-83df9442dc5d"
   scope = ["https://graph.microsoft.com/User.Read"]
   ```

2. PRODU√á√ÉO (Streamlit Cloud):
   ---------------------------
   Configurar secrets via interface web do Streamlit:
   - Settings > Secrets
   - Adicionar mesmo conte√∫do do secrets.toml


================================================================================
‚ö†Ô∏è REGRAS IMPORTANTES PARA NOVAS IMPLEMENTA√á√ïES
================================================================================

1. SEMPRE QUE CRIAR NOVA FUNCIONALIDADE QUE L√ä DADOS:
   --------------------------------------------------
   ‚úì Verificar se arquivo existe localmente PRIMEIRO
   ‚úì Se N√ÉO existir localmente ‚Üí usar ChurnSPConnector
   ‚úì Nunca assumir que arquivo estar√° local em produ√ß√£o

   EXEMPLO:
   ```python
   arquivo_local = os.path.join("output_churn", "dados.parquet")
   
   if os.path.exists(arquivo_local):
       # AMBIENTE LOCAL
       df = pd.read_parquet(arquivo_local)
   else:
       # AMBIENTE PRODU√á√ÉO (SharePoint)
       connector = ChurnSPConnector(st.secrets)
       df = connector.read_csv("dados.csv")
   ```

2. SEMPRE QUE CRIAR NOVA FUNCIONALIDADE QUE SALVA DADOS:
   ------------------------------------------------------
   ‚úì No gerador: salvar localmente em output_churn/
   ‚úì Tentar upload para SharePoint (com try/except)
   ‚úì Se falhar upload: apenas logar aviso, n√£o interromper

   EXEMPLO (no gerador):
   ```python
   # Salvar localmente
   df.to_parquet("output_churn/novo_arquivo.parquet")
   
   # Tentar upload SharePoint
   try:
       connector = ChurnSPConnector(config)
       connector.write_csv(df, "novo_arquivo.csv")
       logger.info("Upload SharePoint OK")
   except Exception as e:
       logger.warning(f"Falha SharePoint (ignorado): {e}")
   ```

3. NOVOS ARQUIVOS DE DADOS:
   -------------------------
   Se adicionar novo arquivo de dados:
   
   a) Atualizar gerador_dados_churn.py:
      - Gerar arquivo em output_churn/
      - Adicionar upload SharePoint

   b) Atualizar app_streamlit_churn.py:
      - Adicionar l√≥gica de leitura com fallback
      - Testar localmente E em produ√ß√£o

   c) Atualizar config_churn.py:
      - Adicionar constante para nome do arquivo

   d) Atualizar secrets.toml (se necess√°rio):
      - Adicionar path do novo arquivo


================================================================================
üß™ TESTANDO MUDAN√áAS
================================================================================

1. TESTE LOCAL:
   ------------
   ‚úì Executar gerador: python gerador_dados_churn.py
   ‚úì Verificar arquivos em output_churn/
   ‚úì Executar app: streamlit run app_streamlit_churn.py
   ‚úì Confirmar que app l√™ dados locais

2. TESTE PRODU√á√ÉO (Simulado Localmente):
   -------------------------------------
   ‚úì Renomear pasta: mv output_churn output_churn_backup
   ‚úì Criar secrets.toml com credenciais SharePoint v√°lidas
   ‚úì Executar app: streamlit run app_streamlit_churn.py
   ‚úì Confirmar que app busca dados do SharePoint
   ‚úì Restaurar pasta: mv output_churn_backup output_churn

3. TESTE PRODU√á√ÉO (Real):
   ----------------------
   ‚úì Deploy no Streamlit Cloud
   ‚úì Configurar secrets via interface web
   ‚úì Verificar logs para confirmar conex√£o SharePoint
   ‚úì Testar todas as funcionalidades do app


================================================================================
üîß TROUBLESHOOTING
================================================================================

ERRO: "Arquivo n√£o encontrado"
-------------------------------
‚Üí Verificar se est√° em produ√ß√£o (sem pasta output_churn)
‚Üí Verificar secrets do SharePoint configurados
‚Üí Verificar permiss√µes da conta no SharePoint
‚Üí Verificar se gerador rodou e fez upload


ERRO: "Falha autentica√ß√£o SharePoint"
--------------------------------------
‚Üí Verificar client_id, client_secret, tenant_id
‚Üí Verificar se app est√° registrado no Azure AD
‚Üí Verificar permiss√µes Files.Read.All no app Azure


ERRO: "Path n√£o encontrado no SharePoint"
-----------------------------------------
‚Üí Path correto: /personal/washington_gouvea_synvia_com_/Documents/Data Analysis/Churn PCLs/
‚Üí Hostname: synviagroup-my.sharepoint.com
‚Üí User UPN: washington.gouvea@synvia.com
‚Üí Verificar se arquivos existem no SharePoint manualmente

ERRO: "Autentica√ß√£o falhou para matriz_cs"
-------------------------------------------
‚Üí Usar credenciais [auth] (n√£o [graph])
‚Üí Client ID correto para VIP: 7c19a480-bc01-45b6-8b74-6a3e6154e876
‚Üí VIPHistoryManager usa st.secrets['auth']

ERRO: "Autentica√ß√£o falhou para churn_analysis"
------------------------------------------------
‚Üí Usar credenciais [graph] (n√£o [auth])
‚Üí Client ID correto para Churn: 680b6cbf-ded3-4839-bdba-cfa8d5051309
‚Üí ChurnSPConnector usa st.secrets['graph']


App lento em produ√ß√£o:
----------------------
‚Üí SharePoint API tem lat√™ncia natural (2-5s por request)
‚Üí Considerar cache com st.cache_data
‚Üí Evitar m√∫ltiplas leituras do mesmo arquivo


================================================================================
üìù CHECKLIST PARA NOVAS FEATURES
================================================================================

Ao adicionar funcionalidade que manipula dados:

‚ñ° C√≥digo funciona com dados locais (desenvolvimento)
‚ñ° C√≥digo funciona com dados do SharePoint (produ√ß√£o)
‚ñ° Try/except para tratar falhas de conex√£o SharePoint
‚ñ° Logs apropriados para debug (logger.info/warning/error)
‚ñ° Testado localmente com pasta output_churn presente
‚ñ° Testado localmente com pasta output_churn ausente (simula prod)
‚ñ° Secrets.toml tem todas configura√ß√µes necess√°rias
‚ñ° Documenta√ß√£o atualizada se necess√°rio


================================================================================
üìö ARQUIVOS RELACIONADOS
================================================================================

churn_sp_connector.py   ‚Üí Implementa conex√£o SharePoint (Graph API)
config_churn.py         ‚Üí Configura√ß√µes globais (caminhos, constantes)
gerador_dados_churn.py  ‚Üí Gera dados e faz upload SharePoint
app_streamlit_churn.py  ‚Üí App principal com leitura local/SharePoint
.streamlit/secrets.toml ‚Üí Credenciais (NUNCA commitar no Git!)


================================================================================
üåê URLs DO SISTEMA
================================================================================

APP PRODU√á√ÉO:
https://syntoxchurn.streamlit.app/

SHAREPOINT (OneDrive):
https://synviagroup-my.sharepoint.com/personal/washington_gouvea_synvia_com_/Documents/Data%20Analysis/Churn%20PCLs/

AZURE AD (Gerenciar Apps):
https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps

GRAPH EXPLORER (Testar APIs):
https://developer.microsoft.com/graph/graph-explorer

TENANT ID:
fee1b506-24b6-444a-919e-83df9442dc5d


================================================================================
√öLTIMA ATUALIZA√á√ÉO: 04/11/2025
================================================================================

